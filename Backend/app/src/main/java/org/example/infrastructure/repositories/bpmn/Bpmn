package org.example.infrastructure.repositories.bpmn;

import org.example.domain.entities.bpmn.BpmnGateway;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

/**
 * Repository for BpmnGateway entities
 */
@Repository
public interface BpmnGatewayRepository extends JpaRepository<BpmnGateway, UUID> {

    /**
     * Find gateways by process
     */
    List<BpmnGateway> findByProcessId(UUID processId);

    /**
     * Find gateways by gateway type
     */
    List<BpmnGateway> findByGatewayType(BpmnGateway.GatewayType gatewayType);

    /**
     * Find gateways by gateway ID
     */
    Optional<BpmnGateway> findByGatewayId(String gatewayId);

    /**
     * Find exclusive gateways
     */
    @Query("SELECT g FROM BpmnGateway g WHERE g.gatewayType = 'EXCLUSIVE_GATEWAY'")
    List<BpmnGateway> findExclusiveGateways();

    /**
     * Find parallel gateways
     */
    @Query("SELECT g FROM BpmnGateway g WHERE g.gatewayType = 'PARALLEL_GATEWAY'")
    List<BpmnGateway> findParallelGateways();

    /**
     * Find merge gateways
     */
    @Query("SELECT g FROM BpmnGateway g WHERE g.isMerge = true")
    List<BpmnGateway> findMergeGateways();

    /**
     * Count gateways by process
     */
    @Query("SELECT COUNT(g) FROM BpmnGateway g WHERE g.process.id = :processId")
    Long countByProcessId(@Param("processId") UUID processId);

    /**
     * Find gateways with default flow
     */
    @Query("SELECT g FROM BpmnGateway g WHERE g.defaultFlow IS NOT NULL")
    List<BpmnGateway> findGatewaysWithDefaultFlow();
}