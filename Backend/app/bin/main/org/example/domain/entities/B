package org.example.domain.entities;

import org.example.domain.valueobjects.BpmnProcessId;

import java.util.Objects;

/**
 * Entity representing the mapping between BPMN elements and API endpoints
 */
public class BpmnApiMapping {
    private final BpmnProcessId processId;
    private final String bpmnElementId;
    private final String bpmnElementName;
    private final String bpmnElementType;
    private final String apiEndpoint;
    private final String httpMethod;
    private final String mappingDescription;

    public BpmnApiMapping(BpmnProcessId processId, String bpmnElementId, String bpmnElementName,
                         String bpmnElementType, String apiEndpoint, String httpMethod,
                         String mappingDescription) {
        this.processId = Objects.requireNonNull(processId, "Process ID cannot be null");
        this.bpmnElementId = Objects.requireNonNull(bpmnElementId, "BPMN element ID cannot be null");
        this.bpmnElementName = Objects.requireNonNull(bpmnElementName, "BPMN element name cannot be null");
        this.bpmnElementType = Objects.requireNonNull(bpmnElementType, "BPMN element type cannot be null");
        this.apiEndpoint = apiEndpoint;
        this.httpMethod = httpMethod;
        this.mappingDescription = mappingDescription;
    }

    /**
     * Creates a BPMN-API mapping
     */
    public static BpmnApiMapping createMapping(BpmnProcessId processId, String bpmnElementId,
                                             String bpmnElementName, String bpmnElementType,
                                             String apiEndpoint, String httpMethod) {
        return new BpmnApiMapping(
            processId, bpmnElementId, bpmnElementName, bpmnElementType,
            apiEndpoint, httpMethod, null
        );
    }

    /**
     * Creates a BPMN-API mapping with description
     */
    public static BpmnApiMapping createMappingWithDescription(BpmnProcessId processId,
                                                             String bpmnElementId, String bpmnElementName,
                                                             String bpmnElementType, String apiEndpoint,
                                                             String httpMethod, String mappingDescription) {
        return new BpmnApiMapping(
            processId, bpmnElementId, bpmnElementName, bpmnElementType,
            apiEndpoint, httpMethod, mappingDescription
        );
    }

    // Getters
    public BpmnProcessId getProcessId() { return processId; }
    public String getBpmnElementId() { return bpmnElementId; }
    public String getBpmnElementName() { return bpmnElementName; }
    public String getBpmnElementType() { return bpmnElementType; }
    public String getApiEndpoint() { return apiEndpoint; }
    public String getHttpMethod() { return httpMethod; }
    public String getMappingDescription() { return mappingDescription; }

    // Business logic methods
    public boolean hasApiMapping() {
        return apiEndpoint != null && !apiEndpoint.trim().isEmpty();
    }

    public boolean hasMappingDescription() {
        return mappingDescription != null && !mappingDescription.trim().isEmpty();
    }

    public boolean isTaskElement() {
        return "task".equalsIgnoreCase(bpmnElementType) || "userTask".equalsIgnoreCase(bpmnElementType);
    }

    public boolean isServiceElement() {
        return "serviceTask".equalsIgnoreCase(bpmnElementType);
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        BpmnApiMapping that = (BpmnApiMapping) o;
        return Objects.equals(processId, that.processId) &&
               Objects.equals(bpmnElementId, that.bpmnElementId);
    }

    @Override
    public int hashCode() {
        return Objects.hash(processId, bpmnElementId);
    }

    @Override
    public String toString() {
        return "BpmnApiMapping{" +
                "processId=" + processId +
                ", bpmnElementId='" + bpmnElementId + '\'' +
                ", bpmnElementName='" + bpmnElementName + '\'' +
                ", bpmnElementType='" + bpmnElementType + '\'' +
                ", apiEndpoint='" + apiEndpoint + '\'' +
                ", httpMethod='" + httpMethod + '\'' +
                '}';
    }
}